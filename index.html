<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Slider Control</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            color: #333;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 28px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .status {
            font-size: 16px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
        }

        .status.connected {
            background: #d4edda;
            color: #155724;
        }

        .status.disconnected {
            background: #f8d7da;
            color: #721c24;
        }

        .connect-btn {
            background: linear-gradient(45deg, #2196F3, #21CBF3);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 0;
            transition: transform 0.2s;
        }

        .connect-btn:hover {
            transform: translateY(-2px);
        }

        /* AMENDMENT 2: Enhanced jog control section */
        .jog-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .jog-section h3 {
            margin-bottom: 15px;
            color: #495057;
        }

        /* AMENDMENT 2: Motor selection buttons */
        .motor-select {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .motor-btn {
            background: #e9ecef;
            border: 2px solid #ced4da;
            color: #495057;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .motor-btn.active {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border-color: #28a745;
        }

        /* AMENDMENT 2: Enhanced slider styling - kept large size */
        .slider-container {
            margin: 20px 0;
            position: relative;
        }

        .jog-slider {
            width: 100%;
            height: 50px;
            background: linear-gradient(to right, #dc3545, #ffc107, #28a745);
            border-radius: 25px;
            outline: none;
            appearance: none;
            cursor: pointer;
        }

        .jog-slider::-webkit-slider-thumb {
            appearance: none;
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            border: 4px solid #007bff;
            cursor: grab;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .jog-slider::-webkit-slider-thumb:active {
            cursor: grabbing;
            transform: scale(1.1);
        }

        .slider-value {
            font-size: 18px;
            font-weight: bold;
            color: #495057;
            margin-top: 10px;
        }
.control-section {
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid #e9ecef;
        }

        .input-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 10px;
        }

        .input-group label {
            font-weight: 600;
            color: #495057;
            min-width: 100px;
        }

        .input-group input {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #ced4da;
            border-radius: 8px;
            font-size: 16px;
        }

        .btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 5px;
            transition: all 0.2s;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn.stop {
            background: linear-gradient(45deg, #dc3545, #fd7e14);
        }

        .btn.home {
            background: linear-gradient(45deg, #6f42c1, #e83e8c);
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .title {
                font-size: 24px;
            }
            
            .input-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .input-group label {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">Camera Slider Control</h1>
            <div class="status disconnected" id="status">Disconnected</div>
            <button class="connect-btn" id="connectBtn">Connect to Slider</button>
        </div>

        <!-- AMENDMENT 2: Enhanced Jog Control Section -->
        <div class="jog-section">
            <h3>Manual Jog Control</h3>
            
            <!-- Motor Selection Buttons -->
            <div class="motor-select">
                <button class="motor-btn active" data-motor="M1">Motor 1</button>
                <button class="motor-btn" data-motor="M2">Motor 2</button>
                <button class="motor-btn" data-motor="BOTH">Both</button>
            </div>
            
            <!-- Large Jog Slider (returns to center) -->
            <div class="slider-container">
                <input type="range" class="jog-slider" id="jogSlider" 
                       min="-100" max="100" value="0" step="1">
                <div class="slider-value" id="sliderValue">0%</div>
            </div>
        </div>

        <div class="control-section">
            <h3 class="section-title">Motor 1 Settings</h3>
            <div class="input-group">
                <label>Start:</label>
                <input type="number" id="m1Start" value="-2000">
            </div>
            <div class="input-group">
                <label>End:</label>
                <input type="number" id="m1End" value="2000">
            </div>
            <div class="input-group">
                <label>Speed:</label>
                <input type="number" id="m1Speed" value="2000">
            </div>
        </div>

        <div class="control-section">
            <h3 class="section-title">Motor 2 Settings</h3>
            <div class="input-group">
                <label>Start:</label>
                <input type="number" id="m2Start" value="-2000">
            </div>
            <div class="input-group">
                <label>End:</label>
                <input type="number" id="m2End" value="2000">
            </div>
            <div class="input-group">
                <label>Speed:</label>
                <input type="number" id="m2Speed" value="2000">
            </div>
        </div>

        <div class="control-section">
            <h3 class="section-title">Sequence Settings</h3>
            <div class="input-group">
                <label>Cycles:</label>
                <input type="number" id="cycles" value="0" min="0">
            </div>
            <div class="input-group">
                <label>Return:</label>
                <input type="checkbox" id="returnEnabled" checked>
            </div>
        </div>

        <div class="control-section">
            <button class="btn" id="runBtn">RUN</button>
            <button class="btn stop" id="stopBtn">STOP</button>
            <button class="btn home" id="homeBtn">HOME</button>
        </div>
    </div>
<script>
        let device;
        let characteristic;
        let selectedMotor = 'M1';  // Default motor selection
        
        // DOM elements
        const status = document.getElementById('status');
        const connectBtn = document.getElementById('connectBtn');
        const jogSlider = document.getElementById('jogSlider');
        const sliderValue = document.getElementById('sliderValue');
        const motorBtns = document.querySelectorAll('.motor-btn');
        
        // Input elements
        const inputs = {
            m1Start: document.getElementById('m1Start'),
            m1End: document.getElementById('m1End'),
            m1Speed: document.getElementById('m1Speed'),
            m2Start: document.getElementById('m2Start'),
            m2End: document.getElementById('m2End'),
            m2Speed: document.getElementById('m2Speed'),
            cycles: document.getElementById('cycles'),
            returnEnabled: document.getElementById('returnEnabled')
        };
        
        // Control buttons
        const runBtn = document.getElementById('runBtn');
        const stopBtn = document.getElementById('stopBtn');
        const homeBtn = document.getElementById('homeBtn');

        /* ===================== BLE CONNECTION ===================== */
        async function connectToDevice() {
            try {
                device = await navigator.bluetooth.requestDevice({
                    filters: [{ name: 'CameraSlider' }],
                    optionalServices: ['12345678-1234-1234-1234-1234567890ab']
                });

                const server = await device.gatt.connect();
                const service = await server.getPrimaryService('12345678-1234-1234-1234-1234567890ab');
                characteristic = await service.getCharacteristic('abcd1234-1234-1234-1234-abcdef123456');

                status.textContent = 'Connected';
                status.className = 'status connected';
                connectBtn.textContent = 'Connected';
                connectBtn.disabled = true;

                // Handle disconnection
                device.addEventListener('gattserverdisconnected', onDisconnected);

            } catch (error) {
                console.error('Connection failed:', error);
                status.textContent = 'Connection failed';
                status.className = 'status disconnected';
            }
        }

        function onDisconnected() {
            status.textContent = 'Disconnected';
            status.className = 'status disconnected';
            connectBtn.textContent = 'Connect to Slider';
            connectBtn.disabled = false;
        }

        /* ===================== BLE SEND ===================== */
        async function sendBLE(command) {
            if (!characteristic) return;
            try {
                await characteristic.writeValue(new TextEncoder().encode(command));
                console.log('Sent:', command);
            } catch (error) {
                console.error('Send failed:', error);
            }
        }

        /* ===================== MOTOR SELECTION ===================== */
        motorBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // Remove active class from all buttons
                motorBtns.forEach(b => b.classList.remove('active'));
                
                // Add active class to clicked button
                btn.classList.add('active');
                
                // Update selected motor
                selectedMotor = btn.dataset.motor;
                
                // Reset slider to center when switching motors
                jogSlider.value = 0;
                sliderValue.textContent = '0%';
                sendBLE(`JOGSLIDER:${selectedMotor}:0`);
            });
        });

        /* ===================== ENHANCED JOG SLIDER ===================== */
        let isSliding = false;
        let centerReturnTimeout;

        // Mouse/touch events for slider
        jogSlider.addEventListener('mousedown', () => isSliding = true);
        jogSlider.addEventListener('mouseup', handleSliderRelease);
        jogSlider.addEventListener('touchstart', () => isSliding = true);
        jogSlider.addEventListener('touchend', handleSliderRelease);

        // Slider input (while dragging)
        jogSlider.addEventListener('input', (e) => {
            const value = parseInt(e.target.value);
            sliderValue.textContent = `${value}%`;
            
            // Only send while actively sliding
            if (isSliding) {
                clearTimeout(centerReturnTimeout);
                sendBLE(`JOGSLIDER:${selectedMotor}:${value}`);
            }
        });

        // Handle slider release - return to center
        function handleSliderRelease() {
            isSliding = false;
            
            // Immediately stop motors
            sendBLE(`JOGSLIDER:${selectedMotor}:0`);
            
            // Animate return to center
            centerReturnTimeout = setTimeout(() => {
                jogSlider.value = 0;
                sliderValue.textContent = '0%';
            }, 100);
        }

        /* ===================== INPUT HANDLERS ===================== */
        // Send settings when inputs change
        Object.entries(inputs).forEach(([key, input]) => {
            input.addEventListener('change', () => {
                const value = input.type === 'checkbox' ? (input.checked ? 1 : 0) : input.value;
                
                switch(key) {
                    case 'm1Start': sendBLE(`M1S:${value}`); break;
                    case 'm1End': sendBLE(`M1E:${value}`); break;
                    case 'm1Speed': sendBLE(`M1SPD:${value}`); break;
                    case 'm2Start': sendBLE(`M2S:${value}`); break;
                    case 'm2End': sendBLE(`M2E:${value}`); break;
                    case 'm2Speed': sendBLE(`M2SPD:${value}`); break;
                    case 'cycles': sendBLE(`CYCLES:${value}`); break;
                    case 'returnEnabled': sendBLE(`RETURN:${value}`); break;
                }
            });
        });

        /* ===================== CONTROL BUTTONS ===================== */
        runBtn.addEventListener('click', () => sendBLE('RUN'));
        stopBtn.addEventListener('click', () => {
            sendBLE('STOP');
            // Also stop any active jogging
            jogSlider.value = 0;
            sliderValue.textContent = '0%';
            sendBLE(`JOGSLIDER:${selectedMotor}:0`);
        });
        homeBtn.addEventListener('click', () => sendBLE('HOME'));

        /* ===================== EVENT LISTENERS ===================== */
        connectBtn.addEventListener('click', connectToDevice);

        // Prevent slider from jumping when page scrolls
        jogSlider.addEventListener('touchmove', (e) => {
            if (isSliding) e.preventDefault();
        }, { passive: false });

        // Initialize motor selection
        document.querySelector('.motor-btn[data-motor="M1"]').classList.add('active');
    </script>
</body>
</html>
















