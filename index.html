
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Slider Control</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #1a1a1a;
            color: white;
            user-select: none;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #4CAF50;
            margin-bottom: 30px;
        }
        
        .section {
            background: #2d2d2d;
            margin: 15px 0;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #444;
        }
        
        .section h2 {
            margin-top: 0;
            color: #4CAF50;
            font-size: 18px;
        }
        
        .row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
        }
        
        label {
            font-weight: bold;
            min-width: 100px;
        }
        
        input[type="number"] {
            width: 100px;
            padding: 10px;
            border: 2px solid #555;
            border-radius: 5px;
            background: #333;
            color: white;
            font-size: 16px;
        }
        
        button {
            padding: 15px 25px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            min-height: 50px;
        }
        
        .btn-primary {
            background: #4CAF50;
            color: white;
        }
        
        .btn-secondary {
            background: #ff9800;
            color: white;
        }
        
        .btn-danger {
            background: #f44336;
            color: white;
        }
        
        button:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì∑ Camera Slider Control</h1>
        
        <!-- Connection Status -->
        <div class="section">
            <h2>üîó Connection</h2>
            <div id="status">Disconnected</div>
            <button id="connectBtn" class="btn-primary">Connect to Slider</button>
        </div>
<!-- Motor 1 Settings -->
        <div class="section">
            <h2>üéØ Motor 1 (Pan/Slide)</h2>
            
            <div class="row">
                <label>Start:</label>
                <input type="number" id="m1Start" value="0">
                <button onclick="setM1Start()" class="btn-primary">Set</button>
            </div>
            
            <div class="row">
                <label>End:</label>
                <input type="number" id="m1End" value="2000">
                <button onclick="setM1End()" class="btn-primary">Set</button>
            </div>
            
            <div class="row">
                <label>Speed:</label>
                <input type="number" id="m1Speed" value="2000" min="100" max="5000">
                <button onclick="setM1Speed()" class="btn-primary">Set</button>
            </div>
        </div>

        <!-- Motor 2 Settings -->
        <div class="section">
            <h2>üîÑ Motor 2 (Tilt/Focus)</h2>
            
            <div class="row">
                <label>Start:</label>
                <input type="number" id="m2Start" value="0">
                <button onclick="setM2Start()" class="btn-primary">Set</button>
            </div>
            
            <div class="row">
                <label>End:</label>
                <input type="number" id="m2End" value="2000">
                <button onclick="setM2End()" class="btn-primary">Set</button>
            </div>
            
            <div class="row">
                <label>Speed:</label>
                <input type="number" id="m2Speed" value="2000" min="100" max="5000">
                <button onclick="setM2Speed()" class="btn-primary">Set</button>
            </div>
        </div>

        <!-- Sequence Controls -->
        <div class="section">
            <h2>‚ñ∂Ô∏è Sequence Control</h2>
            
            <div class="row">
                <button id="runBtn" onclick="toggleRun()" class="btn-primary" style="flex: 1; margin-right: 10px;">START</button>
                <button onclick="stopSlider()" class="btn-danger" style="flex: 1;">STOP</button>
            </div>
            
            <div class="row">
                <label>Cycles:</label>
                <input type="number" id="cycles" value="0" min="0" max="99">
                <button onclick="setCycles()" class="btn-primary">Set</button>
            </div>
            
            <div class="row">
                <label>Return:</label>
                <button id="returnBtn" onclick="toggleReturn()" class="btn-secondary">ON</button>
                <button onclick="homeSlider()" class="btn-secondary">HOME</button>
            </div>
        </div>
<!-- Big Jog Controls -->
        <div class="section">
            <h2>üïπÔ∏è Jog Controls</h2>
            
            <!-- Motor 1 Jog -->
            <div style="margin: 20px 0;">
                <label style="display: block; margin-bottom: 10px; font-size: 18px;">Motor 1 (Pan/Slide)</label>
                <div style="display: flex; gap: 10px;">
                    <button onmousedown="startJog('M1', -100)" onmouseup="stopJog()" ontouchstart="startJog('M1', -100)" ontouchend="stopJog()" class="btn-secondary" style="flex: 1; height: 80px; font-size: 20px;">‚óÄ‚óÄ LEFT</button>
                    <button onmousedown="startJog('M1', 100)" onmouseup="stopJog()" ontouchstart="startJog('M1', 100)" ontouchend="stopJog()" class="btn-secondary" style="flex: 1; height: 80px; font-size: 20px;">RIGHT ‚ñ∂‚ñ∂</button>
                </div>
            </div>
            
            <!-- Motor 2 Jog -->
            <div style="margin: 20px 0;">
                <label style="display: block; margin-bottom: 10px; font-size: 18px;">Motor 2 (Tilt/Focus)</label>
                <div style="display: flex; gap: 10px;">
                    <button onmousedown="startJog('M2', -100)" onmouseup="stopJog()" ontouchstart="startJog('M2', -100)" ontouchend="stopJog()" class="btn-secondary" style="flex: 1; height: 80px; font-size: 20px;">‚óÄ‚óÄ DOWN</button>
                    <button onmousedown="startJog('M2', 100)" onmouseup="stopJog()" ontouchstart="startJog('M2', 100)" ontouchend="stopJog()" class="btn-secondary" style="flex: 1; height: 80px; font-size: 20px;">UP ‚ñ∂‚ñ∂</button>
                </div>
            </div>
            
            <!-- Both Motors Jog -->
            <div style="margin: 20px 0;">
                <label style="display: block; margin-bottom: 10px; font-size: 18px;">Both Motors</label>
                <div style="display: flex; gap: 10px;">
                    <button onmousedown="startJog('BOTH', -100)" onmouseup="stopJog()" ontouchstart="startJog('BOTH', -100)" ontouchend="stopJog()" class="btn-danger" style="flex: 1; height: 80px; font-size: 20px;">‚óÄ‚óÄ BACK</button>
                    <button onmousedown="startJog('BOTH', 100)" onmouseup="stopJog()" ontouchstart="startJog('BOTH', 100)" ontouchend="stopJog()" class="btn-danger" style="flex: 1; height: 80px; font-size: 20px;">FORWARD ‚ñ∂‚ñ∂</button>
                </div>
            </div>
            
            <!-- Jog Speed Control -->
            <div class="row">
                <label>Jog Speed:</label>
                <input type="range" id="jogSpeed" min="10" max="100" value="50" style="flex: 1; margin: 0 15px;">
                <span id="jogSpeedValue">50%</span>
            </div>
        </div>

        <!-- Position Display -->
        <div class="section">
            <h2>üìç Current Position</h2>
            <div class="row">
                <label>Motor 1:</label>
                <span id="pos1">0</span>
                <button onclick="setCurrentAsStart('M1')" class="btn-primary">Set as Start</button>
            </div>
            <div class="row">
                <label>Motor 2:</label>
                <span id="pos2">0</span>
                <button onclick="setCurrentAsStart('M2')" class="btn-primary">Set as Start</button>
            </div>
        </div>
<script>
        // BLE Variables
        let device = null;
        let characteristic = null;
        let isConnected = false;
        let jogInterval = null;
        let isRunning = false;
        let isReturning = true;

        // Update jog speed display
        document.getElementById('jogSpeed').addEventListener('input', function() {
            document.getElementById('jogSpeedValue').textContent = this.value + '%';
        });

        // BLE Connection
        async function connectToSlider() {
            try {
                console.log('Requesting Bluetooth Device...');
                device = await navigator.bluetooth.requestDevice({
                    filters: [{ name: 'CameraSlider' }],
                    optionalServices: ['12345678-1234-1234-1234-1234567890ab']
                });

                console.log('Connecting to GATT Server...');
                const server = await device.gatt.connect();
                
                const service = await server.getPrimaryService('12345678-1234-1234-1234-1234567890ab');
                characteristic = await service.getCharacteristic('abcd1234-1234-1234-1234-abcdef123456');
                
                isConnected = true;
                updateConnectionStatus();
                console.log('Connected to Camera Slider!');
                
            } catch (error) {
                console.error('Connection failed:', error);
                alert('Failed to connect: ' + error.message);
            }
        }

        // Update connection status display
        function updateConnectionStatus() {
            const statusEl = document.getElementById('status');
            const connectBtn = document.getElementById('connectBtn');
            
            if (isConnected) {
                statusEl.textContent = '‚úÖ Connected';
                statusEl.style.color = '#4CAF50';
                connectBtn.textContent = 'Disconnect';
                connectBtn.onclick = disconnect;
            } else {
                statusEl.textContent = '‚ùå Disconnected';
                statusEl.style.color = '#f44336';
                connectBtn.textContent = 'Connect to Slider';
                connectBtn.onclick = connectToSlider;
            }
        }

        // Disconnect BLE
        function disconnect() {
            if (device && device.gatt.connected) {
                device.gatt.disconnect();
            }
            isConnected = false;
            device = null;
            characteristic = null;
            updateConnectionStatus();
        }

        // Send BLE command
        async function sendCommand(command) {
            if (!characteristic) {
                alert('Please connect to slider first');
                return;
            }
            
            try {
                const encoder = new TextEncoder();
                await characteristic.writeValue(encoder.encode(command));
                console.log('Sent:', command);
            } catch (error) {
                console.error('Send failed:', error);
                alert('Failed to send command');
            }
        }
<script>
        // BLE Variables
        let device = null;
        let characteristic = null;
        let isConnected = false;
        let jogInterval = null;
        let isRunning = false;
        let isReturning = true;

        // Update jog speed display
        document.getElementById('jogSpeed').addEventListener('input', function() {
            document.getElementById('jogSpeedValue').textContent = this.value + '%';
        });

        // BLE Connection
        async function connectToSlider() {
            try {
                console.log('Requesting Bluetooth Device...');
                device = await navigator.bluetooth.requestDevice({
                    filters: [{ name: 'CameraSlider' }],
                    optionalServices: ['12345678-1234-1234-1234-1234567890ab']
                });

                console.log('Connecting to GATT Server...');
                const server = await device.gatt.connect();
                
                const service = await server.getPrimaryService('12345678-1234-1234-1234-1234567890ab');
                characteristic = await service.getCharacteristic('abcd1234-1234-1234-1234-abcdef123456');
                
                isConnected = true;
                updateConnectionStatus();
                console.log('Connected to Camera Slider!');
                
            } catch (error) {
                console.error('Connection failed:', error);
                alert('Failed to connect: ' + error.message);
            }
        }

        // Update connection status display
        function updateConnectionStatus() {
            const statusEl = document.getElementById('status');
            const connectBtn = document.getElementById('connectBtn');
            
            if (isConnected) {
                statusEl.textContent = '‚úÖ Connected';
                statusEl.style.color = '#4CAF50';
                connectBtn.textContent = 'Disconnect';
                connectBtn.onclick = disconnect;
            } else {
                statusEl.textContent = '‚ùå Disconnected';
                statusEl.style.color = '#f44336';
                connectBtn.textContent = 'Connect to Slider';
                connectBtn.onclick = connectToSlider;
            }
        }

        // Disconnect BLE
        function disconnect() {
            if (device && device.gatt.connected) {
                device.gatt.disconnect();
            }
            isConnected = false;
            device = null;
            characteristic = null;
            updateConnectionStatus();
        }

        // Send BLE command
        async function sendCommand(command) {
            if (!characteristic) {
                alert('Please connect to slider first');
                return;
            }
            
            try {
                const encoder = new TextEncoder();
                await characteristic.writeValue(encoder.encode(command));
                console.log('Sent:', command);
            } catch (error) {
                console.error('Send failed:', error);
                alert('Failed to send command');
            }
        }
// Position Update Loop
        function startPositionUpdates() {
            if (!isConnected) return;
            
            setInterval(async function() {
                try {
                    // Request position data
                    await sendCommand('POS?');
                    
                    // Note: In a real implementation, you'd need to set up
                    // BLE notifications to receive position data back
                    // For now, we'll simulate position updates
                    updatePositionDisplay();
                } catch (error) {
                    console.error('Position update failed:', error);
                }
            }, 1000); // Update every second
        }

        // Simulate position updates (replace with actual BLE notification handling)
        function updatePositionDisplay() {
            // In a real implementation, parse received position data
            // For now, just show placeholder values
            const pos1 = Math.floor(Math.random() * 2000);
            const pos2 = Math.floor(Math.random() * 2000);
            
            document.getElementById('pos1').textContent = pos1;
            document.getElementById('pos2').textContent = pos2;
        }

        // Status Update Function
        function updateSliderStatus(status) {
            const statusDisplay = document.getElementById('sliderStatus');
            const runBtn = document.getElementById('runBtn');
            
            switch(status) {
                case 'running':
                    statusDisplay.textContent = '‚ñ∂Ô∏è Running';
                    statusDisplay.style.color = '#4CAF50';
                    runBtn.textContent = 'PAUSE';
                    runBtn.className = 'btn-danger';
                    isRunning = true;
                    break;
                case 'paused':
                    statusDisplay.textContent = '‚è∏Ô∏è Paused';
                    statusDisplay.style.color = '#ff9800';
                    runBtn.textContent = 'RESUME';
                    runBtn.className = 'btn-primary';
                    break;
                case 'stopped':
                    statusDisplay.textContent = '‚èπÔ∏è Stopped';
                    statusDisplay.style.color = '#666';
                    runBtn.textContent = 'START';
                    runBtn.className = 'btn-primary';
                    isRunning = false;
                    break;
                case 'homing':
                    statusDisplay.textContent = 'üè† Homing';
                    statusDisplay.style.color = '#2196F3';
                    break;
            }
        }

        // Enhanced BLE command sender with error handling
        async function sendCommandWithRetry(command, retries = 3) {
            for (let i = 0; i < retries; i++) {
                try {
                    await sendCommand(command);
                    return true;
                } catch (error) {
                    if (i === retries - 1) {
                        console.error('Command failed after retries:', command, error);
                        return false;
                    }
                    await new Promise(resolve => setTimeout(resolve, 100)); // Wait before retry
                }
            }
        }

        // Touch event prevention for mobile
        document.addEventListener('touchmove', function(e) {
            if (e.target.tagName === 'BUTTON') {
                e.preventDefault();
            }
        }, { passive: false });

        // Prevent context menu on long press for buttons
        document.addEventListener('contextmenu', function(e) {
            if (e.target.tagName === 'BUTTON') {
                e.preventDefault();
            }
        });

        // Initialize position updates when connected
        function onBLEConnected() {
            startPositionUpdates();
            updateSliderStatus('stopped');
        }
// Mobile orientation handling
        window.addEventListener('orientationchange', function() {
            setTimeout(function() {
                // Recalculate layout after orientation change
                const viewport = document.querySelector('meta[name="viewport"]');
                viewport.content = "width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no";
            }, 100);
        });

        // Prevent zoom on double tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Initialize connection status display
        updateConnectionStatus();
        
        // Auto-connect if previously paired (optional)
        if (localStorage.getItem('autoConnect') === 'true') {
            setTimeout(connectToSlider, 1000);
        }
    </script>
</body>
</html>


















