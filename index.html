<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Slider Control</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        .control-group {
            margin-bottom: 25px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        
        .control-group h3 {
            margin: 0 0 15px 0;
            color: #444;
            font-size: 16px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }
label {
            display: block;
            margin: 10px 0 5px 0;
            font-weight: bold;
            color: #555;
        }
        
        input[type="number"], input[type="range"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        input[type="range"] {
            height: 40px;
            -webkit-appearance: none;
            background: #ddd;
            border-radius: 20px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #007bff;
            cursor: pointer;
        }
        
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            margin: 5px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            min-width: 120px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #0056b3;
        }
        
        button:active {
            background-color: #004494;
        }
        
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }
.button-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }
        
        .button-row button {
            flex: 1;
            min-width: 100px;
            max-width: 150px;
        }
        
        #connectionStatus {
            font-weight: bold;
            margin-top: 10px;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            font-size: 14px;
            border: 2px solid;
        }
        
        .status-connected {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        
        .status-disconnected {
            color: #721c24;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        
        .slider-container label {
            margin: 0;
            min-width: 100px;
            font-size: 14px;
        }
        
        .slider-container input[type="range"] {
            flex: 1;
            margin: 0;
        }
        
        .slider-value {
            min-width: 50px;
            text-align: center;
            font-weight: bold;
            color: #007bff;
        }
.error-message {
            color: #dc3545;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            display: none;
        }
        
        .success-message {
            color: #155724;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            display: none;
        }
        
        .input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        
        .input-group label {
            margin: 0;
            min-width: 80px;
            font-size: 14px;
        }
        
        .input-group input {
            flex: 1;
            margin: 0;
        }
        
        .input-group .unit {
            min-width: 40px;
            font-size: 12px;
            color: #666;
        }
        
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 15px;
            }
            
            .button-row {
                flex-direction: column;
            }
            
            .button-row button {
                max-width: none;
                width: 100%;
            }
            
            .slider-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .slider-container label {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé¨ Camera Slider Control</h1>
        
        <!-- Connection Status -->
        <div id="connectionStatus" class="status-disconnected">
            Disconnected - Click Connect to start
        </div>
        
        <!-- Connection Controls -->
        <div class="control-group">
            <h3>üì° Connection</h3>
            <div class="button-row">
                <button id="connectBtn" onclick="connectBLE()">Connect</button>
                <button id="disconnectBtn" onclick="disconnectBLE()" disabled>Disconnect</button>
            </div>
        </div>
        
        <!-- Motor 1 Controls -->
        <div class="control-group">
            <h3>üéØ Motor 1 Settings</h3>
            
            <div class="input-group">
                <label for="m1Start">Start Position:</label>
                <input type="number" id="m1Start" value="0" oninput="sendCommand('M1S:' + this.value)">
                <span class="unit">steps</span>
            </div>
            
            <div class="input-group">
                <label for="m1End">End Position:</label>
                <input type="number" id="m1End" value="2000" oninput="sendCommand('M1E:' + this.value)">
                <span class="unit">steps</span>
            </div>
            
            <div class="input-group">
                <label for="m1Speed">Speed:</label>
                <input type="number" id="m1Speed" value="2000" min="100" max="8000" oninput="sendCommand('M1SPD:' + this.value)">
                <span class="unit">steps/s</span>
            </div>
        </div>
<!-- Motor 2 Controls -->
        <div class="control-group">
            <h3>üéØ Motor 2 Settings</h3>
            
            <div class="input-group">
                <label for="m2Start">Start Position:</label>
                <input type="number" id="m2Start" value="0" oninput="sendCommand('M2S:' + this.value)">
                <span class="unit">steps</span>
            </div>
            
            <div class="input-group">
                <label for="m2End">End Position:</label>
                <input type="number" id="m2End" value="2000" oninput="sendCommand('M2E:' + this.value)">
                <span class="unit">steps</span>
            </div>
            
            <div class="input-group">
                <label for="m2Speed">Speed:</label>
                <input type="number" id="m2Speed" value="2000" min="100" max="8000" oninput="sendCommand('M2SPD:' + this.value)">
                <span class="unit">steps/s</span>
            </div>
        </div>
        
        <!-- Cycle Controls -->
        <div class="control-group">
            <h3>üîÑ Cycle Settings</h3>
            
            <div class="input-group">
                <label for="cycles">Cycles:</label>
                <input type="number" id="cycles" value="0" min="0" max="100" oninput="sendCommand('CYCLES:' + this.value)">
                <span class="unit">0 = ‚àû</span>
            </div>
            
            <div class="input-group">
                <label for="returnMode">Return Mode:</label>
                <select id="returnMode" onchange="sendCommand('RETURN:' + (this.value === 'true' ? '1' : '0'))">
                    <option value="true">Return to Start</option>
                    <option value="false">One Direction</option>
                </select>
            </div>
        </div>
<!-- Manual Controls -->
        <div class="control-group">
            <h3>üéÆ Manual Controls</h3>
            
            <div class="slider-container">
                <label>Motor 1:</label>
                <input type="range" id="jogM1" min="-100" max="100" value="0" 
                       oninput="handleJogSlider('M1', this.value)" 
                       onchange="this.value = 0; handleJogSlider('M1', 0)">
                <span class="slider-value" id="jogM1Value">0</span>
            </div>
            
            <div class="slider-container">
                <label>Motor 2:</label>
                <input type="range" id="jogM2" min="-100" max="100" value="0" 
                       oninput="handleJogSlider('M2', this.value)" 
                       onchange="this.value = 0; handleJogSlider('M2', 0)">
                <span class="slider-value" id="jogM2Value">0</span>
            </div>
            
            <div class="slider-container">
                <label>Both Motors:</label>
                <input type="range" id="jogBoth" min="-100" max="100" value="0" 
                       oninput="handleJogSlider('BOTH', this.value)" 
                       onchange="this.value = 0; handleJogSlider('BOTH', 0)">
                <span class="slider-value" id="jogBothValue">0</span>
            </div>
        </div>
        
        <!-- Action Controls -->
        <div class="control-group">
            <h3>‚ö° Actions</h3>
            <div class="button-row">
                <button onclick="sendCommand('RUN')">üèÉ Run</button>
                <button onclick="sendCommand('STOP')">üõë Stop</button>
                <button onclick="sendCommand('HOME')">üè† Home</button>
            </div>
        </div>
<!-- Status Display -->
        <div class="control-group">
            <h3>üìä Status</h3>
            <div id="statusDisplay">
                <div class="status-item">
                    <span>Motor 1:</span>
                    <span id="m1Status">Stopped</span>
                </div>
                <div class="status-item">
                    <span>Motor 2:</span>
                    <span id="m2Status">Stopped</span>
                </div>
                <div class="status-item">
                    <span>Cycle:</span>
                    <span id="cycleStatus">0/0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        let bleDevice = null;
        let bleCharacteristic = null;
        let isConnected = false;
        
        const SERVICE_UUID = '12345678-1234-1234-1234-1234567890ab';
        const CHARACTERISTIC_UUID = 'abcd1234-1234-1234-1234-abcdef123456';
        
        // Update connection status display
        function updateConnectionStatus(status, isConnected) {
            const statusDiv = document.getElementById('connectionStatus');
            const connectBtn = document.getElementById('connectBtn');
            const disconnectBtn = document.getElementById('disconnectBtn');
            
            statusDiv.textContent = status;
            statusDiv.className = isConnected ? 'status-connected' : 'status-disconnected';
            
            connectBtn.disabled = isConnected;
            disconnectBtn.disabled = !isConnected;
        }
// Connect to BLE device
        async function connectBLE() {
            try {
                updateConnectionStatus('Connecting...', false);
                
                bleDevice = await navigator.bluetooth.requestDevice({
                    filters: [{ name: 'CameraSlider' }],
                    optionalServices: [SERVICE_UUID]
                });
                
                const server = await bleDevice.gatt.connect();
                const service = await server.getPrimaryService(SERVICE_UUID);
                bleCharacteristic = await service.getCharacteristic(CHARACTERISTIC_UUID);
                
                isConnected = true;
                updateConnectionStatus('Connected', true);
                
                bleDevice.addEventListener('gattserverdisconnected', () => {
                    isConnected = false;
                    updateConnectionStatus('Disconnected', false);
                });
                
            } catch (error) {
                console.error('BLE connection failed:', error);
                updateConnectionStatus('Connection Failed', false);
            }
        }
        
        // Disconnect BLE device
        async function disconnectBLE() {
            if (bleDevice && bleDevice.gatt.connected) {
                bleDevice.gatt.disconnect();
            }
            isConnected = false;
            updateConnectionStatus('Disconnected', false);
        }
        
        // Send command to Arduino
        async function sendCommand(command) {
            if (!isConnected || !bleCharacteristic) {
                console.log('Not connected to device');
                return;
            }
            
            try {
                const encoder = new TextEncoder();
                await bleCharacteristic.writeValue(encoder.encode(command));
                console.log('Sent:', command);
            } catch (error) {
                console.error('Failed to send command:', error);
            }
        }
// Handle parameter input changes
        function handleParameterChange(param, value) {
            const numValue = parseInt(value);
            if (isNaN(numValue)) return;
            
            let command = '';
            switch(param) {
                case 'M1S': command = `M1S:${numValue}`; break;
                case 'M1E': command = `M1E:${numValue}`; break;
                case 'M1SPD': command = `M1SPD:${numValue}`; break;
                case 'M2S': command = `M2S:${numValue}`; break;
                case 'M2E': command = `M2E:${numValue}`; break;
                case 'M2SPD': command = `M2SPD:${numValue}`; break;
                case 'CYCLES': command = `CYCLES:${numValue}`; break;
                case 'RETURN': command = `RETURN:${value === 'true' ? 1 : 0}`; break;
            }
            if (command) sendCommand(command);
        }
        
        // Handle jog slider movement
        function handleJogSlider(motor, value) {
            const sliderValue = parseInt(value);
            document.getElementById(`jog${motor}Value`).textContent = sliderValue;
            
            const command = `JOGSLIDER:${motor}:${sliderValue}`;
            sendCommand(command);
        }
        
        // Update display values from inputs
        function updateDisplayValue(inputId, displayId) {
            const input = document.getElementById(inputId);
            const display = document.getElementById(displayId);
            display.textContent = input.value;
        }
        
        // Initialize the interface
        function initializeInterface() {
            updateConnectionStatus('Not Connected', false);
            
            // Set initial display values
            updateDisplayValue('m1Start', 'm1StartValue');
            updateDisplayValue('m1End', 'm1EndValue');
            updateDisplayValue('m1Speed', 'm1SpeedValue');
            updateDisplayValue('m2Start', 'm2StartValue');
            updateDisplayValue('m2End', 'm2EndValue');
            updateDisplayValue('m2Speed', 'm2SpeedValue');
            updateDisplayValue('cycles', 'cyclesValue');
        }
// Initialize event listeners
        function setupEventListeners() {
            // Connection buttons
            document.getElementById('connectBtn').addEventListener('click', connectBLE);
            document.getElementById('disconnectBtn').addEventListener('click', disconnectBLE);
            
            // Control buttons
            document.getElementById('runBtn').addEventListener('click', () => sendCommand('RUN'));
            document.getElementById('stopBtn').addEventListener('click', () => sendCommand('STOP'));
            document.getElementById('homeBtn').addEventListener('click', () => sendCommand('HOME'));
            
            // Parameter inputs
            document.getElementById('m1Start').addEventListener('input', (e) => {
                handleParameterChange('M1S', e.target.value);
                updateDisplayValue('m1Start', 'm1StartValue');
            });
            
            document.getElementById('m1End').addEventListener('input', (e) => {
                handleParameterChange('M1E', e.target.value);
                updateDisplayValue('m1End', 'm1EndValue');
            });
            
            document.getElementById('m1Speed').addEventListener('input', (e) => {
                handleParameterChange('M1SPD', e.target.value);
                updateDisplayValue('m1Speed', 'm1SpeedValue');
            });
            
            document.getElementById('m2Start').addEventListener('input', (e) => {
                handleParameterChange('M2S', e.target.value);
                updateDisplayValue('m2Start', 'm2StartValue');
            });
            
            document.getElementById('m2End').addEventListener('input', (e) => {
                handleParameterChange('M2E', e.target.value);
                updateDisplayValue('m2End', 'm2EndValue');
            });
            
            document.getElementById('m2Speed').addEventListener('input', (e) => {
                handleParameterChange('M2SPD', e.target.value);
                updateDisplayValue('m2Speed', 'm2SpeedValue');
            });
document.getElementById('cycles').addEventListener('input', (e) => {
                handleParameterChange('CYCLES', e.target.value);
                updateDisplayValue('cycles', 'cyclesValue');
            });
            
            document.getElementById('returnHome').addEventListener('change', (e) => {
                handleParameterChange('RETURN', e.target.checked.toString());
            });
            
            // Jog sliders
            document.getElementById('jogM1').addEventListener('input', (e) => {
                handleJogSlider('M1', e.target.value);
            });
            
            document.getElementById('jogM2').addEventListener('input', (e) => {
                handleJogSlider('M2', e.target.value);
            });
            
            // Reset sliders when released
            document.getElementById('jogM1').addEventListener('mouseup', () => {
                document.getElementById('jogM1').value = 0;
                document.getElementById('jog1Value').textContent = '0';
                sendCommand('JOGSLIDER:M1:0');
            });
            
            document.getElementById('jogM2').addEventListener('mouseup', () => {
                document.getElementById('jogM2').value = 0;
                document.getElementById('jog2Value').textContent = '0';
                sendCommand('JOGSLIDER:M2:0');
            });
            
            // Touch events for mobile
            document.getElementById('jogM1').addEventListener('touchend', () => {
                document.getElementById('jogM1').value = 0;
                document.getElementById('jog1Value').textContent = '0';
                sendCommand('JOGSLIDER:M1:0');
            });
            
            document.getElementById('jogM2').addEventListener('touchend', () => {
                document.getElementById('jogM2').value = 0;
                document.getElementById('jog2Value').textContent = '0';
                sendCommand('JOGSLIDER:M2:0');
            });
        }
// Initialize the page when loaded
        document.addEventListener('DOMContentLoaded', function() {
            initializeInterface();
            setupEventListeners();
            
            // Check for Web Bluetooth support
            if (!navigator.bluetooth) {
                document.getElementById('connectionStatus').textContent = 'Web Bluetooth not supported';
                document.getElementById('connectBtn').disabled = true;
                console.error('Web Bluetooth API is not available in this browser');
            }
        });
    </script>
</body>
</html>

