<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Camera Slider</title>
<style>
body { background:#111; color:white; font-family:Arial; text-align:center; }
input { width:80px; text-align:right; margin:5px; }
button { margin:5px; padding:10px 15px; }
</style>
</head>

<body>

<h2>Camera Slider</h2>

<!-- Numeric fields -->
<div>
  M1 START: <input type="number" id="M1S" value="0"><br>
  M1 END: <input type="number" id="M1E" value="2000"><br>
  M2 START: <input type="number" id="M2S" value="0"><br>
  M2 END: <input type="number" id="M2E" value="2000"><br>
  M1 SPEED: <input type="number" id="M1SPD" value="2000"><br>
  M2 SPEED: <input type="number" id="M2SPD" value="2000"><br>
  CYCLES: <input type="number" id="CYCLES" value="0"><br>
</div>

<!-- Action buttons -->
<div>
  <button onclick="sendValues()">SEND VALUES</button><br>
  <button onclick="sendCmd('RUN')">RUN</button><br>
  <button onclick="sendCmd('TRACKM1')">TRACK M1</button>
  <button onclick="sendCmd('TRACKM2')">TRACK M2</button>
  <button onclick="sendCmd('TRACKBOTH')">TRACK BOTH</button>
</div>

<!-- Connect -->
<div>
  <button onclick="connectBLE()">CONNECT</button>
</div>

<script>
let device;
let characteristic;
let connected = false;

// Initial values (can be updated from BLE if needed)
let values = {
  M1S: 0,
  M1E: 2000,
  M2S: 0,
  M2E: 2000,
  M1SPD: 2000,
  M2SPD: 2000,
  CYCLES: 0
};

// Connect to ESP32 via BLE
async function connectBLE() {
  try {
    device = await navigator.bluetooth.requestDevice({
      filters: [{ name: 'CameraSlider' }],
      optionalServices: ['12345678-1234-1234-1234-1234567890ab']
    });

    const server = await device.gatt.connect();
    const service = await server.getPrimaryService(
      '12345678-1234-1234-1234-1234567890ab'
    );

    characteristic = await service.getCharacteristic(
      'abcd1234-1234-1234-1234-abcdef123456'
    );

    connected = true;
    alert("BLE Connected");

    // Optionally, request current values from ESP32 if implemented
    populateFields();

  } catch (e) {
    alert("BLE Error: " + e);
  }
}

// Send single command (RUN/TRACK)
function sendCmd(cmd) {
  if (!connected) { alert("Not connected"); return; }
  const data = new TextEncoder().encode(cmd + "\n");
  characteristic.writeValue(data);
}

// Send all numeric values to ESP32
function sendValues() {
  if (!connected) { alert("Not connected"); return; }

  values.M1S = document.getElementById('M1S').value;
  values.M1E = document.getElementById('M1E').value;
  values.M2S = document.getElementById('M2S').value;
  values.M2E = document.getElementById('M2E').value;
  values.M1SPD = document.getElementById('M1SPD').value;
  values.M2SPD = document.getElementById('M2SPD').value;
  values.CYCLES = document.getElementById('CYCLES').value;

  const cmds = [
    `M1S:${values.M1S}`,
    `M1E:${values.M1E}`,
    `M2S:${values.M2S}`,
    `M2E:${values.M2E}`,
    `M1SPD:${values.M1SPD}`,
    `M2SPD:${values.M2SPD}`,
    `CYCLES:${values.CYCLES}`
  ];

  cmds.forEach(cmd => {
    const data = new TextEncoder().encode(cmd + "\n");
    characteristic.writeValue(data);
  });

  alert("Values sent!");
}

// Populate HTML fields from current values
function populateFields() {
  document.getElementById('M1S').value = values.M1S;
  document.getElementById('M1E').value = values.M1E;
  document.getElementById('M2S').value = values.M2S;
  document.getElementById('M2E').value = values.M2E;
  document.getElementById('M1SPD').value = values.M1SPD;
  document.getElementById('M2SPD').value = values.M2SPD;
  document.getElementById('CYCLES').value = values.CYCLES;
}

</script>

</body>
</html>

