<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Camera Slider</title>

<style>
body {
  background:#111;
  color:white;
  font-family:Arial;
  text-align:center;
}
input {
  width:90px;
  text-align:right;
  margin:4px;
}
button {
  margin:6px;
  padding:10px 18px;
  font-size:14px;
}
fieldset {
  border:1px solid #444;
  margin:10px;
  padding:10px;
}
legend { color:#aaa; }
</style>
</head>

<body>

<h2>Camera Slider</h2>

<!-- POSITION SETTINGS -->
<fieldset>
<legend>Positions</legend>
M1 START <input type="number" id="M1S" value="0"><br>
M1 END <input type="number" id="M1E" value="2000"><br>
M2 START <input type="number" id="M2S" value="0"><br>
M2 END <input type="number" id="M2E" value="2000"><br>
</fieldset>

<!-- SPEED -->
<fieldset>
<legend>Speed</legend>
M1 SPEED <input type="number" id="M1SPD" value="2000"><br>
M2 SPEED <input type="number" id="M2SPD" value="2000"><br>
</fieldset>

<!-- HOMING -->
<fieldset>
<legend>Homing (no switches)</legend>
M1 HOME OFFSET <input type="number" id="M1HOME" value="-2000"><br>
M2 HOME OFFSET <input type="number" id="M2HOME" value="-2000"><br>
<button onclick="sendHoming()">HOME</button>
</fieldset>

<!-- CYCLES -->
<fieldset>
<legend>Cycles</legend>
CYCLES <input type="number" id="CYCLES" value="0">
<br>
<button onclick="setInfinite()">INF</button>
</fieldset>

<!-- ACTIONS -->
<fieldset>
<legend>Actions</legend>
<button onclick="sendValues()">SEND VALUES</button><br>
<button onclick="sendCmd('RUN')">RUN</button><br><br>
<button onclick="sendCmd('TRACKM1')">TRACK M1</button>
<button onclick="sendCmd('TRACKM2')">TRACK M2</button>
<button onclick="sendCmd('TRACKBOTH')">TRACK BOTH</button>
</fieldset>

<!-- CONNECT -->
<button onclick="connectBLE()">CONNECT</button>

<script>
let device;
let characteristic;
let connected = false;

const SERVICE_UUID = '12345678-1234-1234-1234-1234567890ab';
const CHAR_UUID    = 'abcd1234-1234-1234-1234-abcdef123456';

async function connectBLE() {
  try {
    device = await navigator.bluetooth.requestDevice({
      filters: [{ name: 'CameraSlider' }],
      optionalServices: [SERVICE_UUID]
    });

    const server = await device.gatt.connect();
    const service = await server.getPrimaryService(SERVICE_UUID);
    characteristic = await service.getCharacteristic(CHAR_UUID);

    connected = true;
    alert("BLE Connected");

  } catch (e) {
    alert("BLE Error: " + e);
  }
}

function sendCmd(cmd) {
  if (!connected) {
    alert("Not connected");
    return;
  }
  characteristic.writeValue(
    new TextEncoder().encode(cmd + "\n")
  );
}

function sendValues() {
  if (!connected) { alert("Not connected"); return; }

  const cmds = [
    `M1S:${M1S.value}`,
    `M1E:${M1E.value}`,
    `M2S:${M2S.value}`,
    `M2E:${M2E.value}`,
    `M1SPD:${M1SPD.value}`,
    `M2SPD:${M2SPD.value}`,
    `CYCLES:${CYCLES.value}`
  ];

  cmds.forEach(cmd =>
    characteristic.writeValue(
      new TextEncoder().encode(cmd + "\n")
    )
  );

  alert("Values sent");
}

function sendHoming() {
  if (!connected) { alert("Not connected"); return; }

  sendCmd(`M1HOME:${M1HOME.value}`);
  sendCmd(`M2HOME:${M2HOME.value}`);
  sendCmd("HOME");
}

function setInfinite() {
  document.getElementById('CYCLES').value = 0;
}
</script>

</body>
</html>

